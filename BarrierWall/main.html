<!DOCTYPE html>
<html>
	<head>
		<title>弹幕</title>
        <link rel="stylesheet" type="text/css" href="css/styles.css">
	</head>
	<body>
        <img src="images/0.png" style="width:100%; height:100%"/>  
		<div class="app" id="app">

            <div id="tt">
                <p>{{ contents }}</p>
            </div>

			<div id="Tc">
				<div id="tc">

				</div>
			</div>	

			<div id="CON">
				<div id="con">
					<div class="con" id="con1">
						<ul>
							<li v-for="item in addressList">
								<img v-bind:src="item.headPortrait" id="IMG" alt=""/>
								<div id="item">
									<span>{{item.person}}</span>
									<p>{{item.content}}</p>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>

			<div id="input">
				<input type="text" name="" id="text" v-model="newPerson.content" value="" placeholder="这里输入聊天内容"/>
				<input type="submit" id="createPerson" @click="createPerson" value="发送"/>	
				<input type="submit" id="danmu" @click="danmu" value="弹幕发送"/>		
				<input type="submit" id="picture" @click="picture" value="图片发送"/>		
			</div>
		</div>
	</body>

	<script src="js/vue.js"></script>
	<script src="js/vue-resource.common.js"></script>

	<script>
	    var timer = null;
	    function $(id) { return document.getElementById(id) };
	    var linenumber = 5;

	    new Vue({
	        el: '#app',

	        data: {
	            addressList: [],
	            timer: null,
	            newarr: [],
	            contents: "",
	            newPerson: {
	                person: '消息',
	                content: '',
	                headPortrait: 'images/1.jpg'
	            }
	        },

	        methods: {
	            createPerson: function () {
	                var _this = this;
	                // 添加完newPerson对象
	                if (this.newPerson.content != "") {
	                    this.newPerson.person = "管理员";
	                    this.addressList.push(this.newPerson);
	                    // 添加完newPerson对象后，重置newPerson对象
	                    this.newPerson = { person: '消息', content: '', headPortrait: 'images/1.jpg' };
	                    setTimeout(function () {//延时改变滚动条高度
	                        var div = document.getElementById('con');
	                        var div1 = document.getElementById('con1');
	                        div.scrollTop = div1.offsetHeight;
	                    })
	                    var text = $("text").value;
	                    this.contents = text;
	                    $("tt").style.display = "block";
	                }
	            },

	            picture: function () {
	                if (this.newPerson.content != "") {
	                    var _this = this;
	                    // 添加完newPerson对象
	                    this.addressList.push(this.newPerson);
	                    // 添加完newPerson对象后，重置newPerson对象
	                    this.newPerson = { person: '消息', content: '', headPortrait: 'images/1.jpg' };
	                    setTimeout(function () {//延时改变滚动条高度
	                        var div = document.getElementById('con');
	                        var div1 = document.getElementById('con1');
	                        div.scrollTop = div1.offsetHeight;
	                    });

	                    //danmu
	                    var newarr = [];
	                    clearInterval(timer);
	                    var newnode = document.createElement("img");
	                    newnode.innerHTML = text;
	                    var num = parseInt((Math.random() * 10) % linenumber);
	                    var num2 = parseInt(($("tc").offsetHeight) / linenumber);
	                    newnode.style.background = "url(images/1.jpg)"
	                    newnode.style.top = (num * num2) + "px";
	                    newnode.style.height = num2 + "px";
	                    newnode.style.left = "100%";
	                    newnode.src = "images/1.jpg";
	                    newnode.style.position = "relative";
	                    $("tc").appendChild(newnode);
	                    timer = setInterval(this.move2, 0.1);
	                }
	            },

	            danmu: function () {
	                if (this.newPerson.content != "") {
	                    var _this = this;
	                    // 添加完newPerson对象
	                    this.addressList.push(this.newPerson);
	                    // 添加完newPerson对象后，重置newPerson对象
	                    this.newPerson = { person: '消息', content: '', headPortrait: 'images/1.jpg' };
	                    setTimeout(function () {//延时改变滚动条高度
	                        var div = document.getElementById('con');
	                        var div1 = document.getElementById('con1');
	                        div.scrollTop = div1.offsetHeight;
	                    });

	                    //danmu
	                    var newarr = [];
	                    clearInterval(timer);
	                    var text = $("text").value;
	                    var newnode = document.createElement("div");
	                    newnode.innerHTML = text;
	                    var num = parseInt( (Math.random() * 10) % linenumber );
	                    var num2 = parseInt( ($("tc").offsetHeight) / linenumber );
	                    newnode.style.top = (num * num2) + "px";
	                    newnode.style.height = num2 + "px";
	                    newnode.style.fontSize = num2 + "px";
	                    newnode.style.textAlign = "center";
	                    newnode.style.lineHeight = "100%";
	                    newnode.style.display = "flex";
	                    newnode.style.left = "100%";
	                    newnode.style.background = "#" + this.randomColor();
	                    $("tc").appendChild(newnode);
	                    timer = setInterval(this.move, 0.1);
	                }
	            },

	            move: function () {
	                var arr = $("tc").getElementsByTagName("div");
	                for (var i = 0; i < arr.length; i++) {
	                    var num2 = ((($("tc").offsetWidth) + (2 * arr[i].offsetWidth)) / 2000);
	                    if (num2 <= 1)
	                        num2 = 1;
	                    var num = arr[i].offsetLeft - num2;
	                    arr[i].style.left = num + "px";
	                    if (num < -arr[i].offsetWidth) {
	                        $("tc").removeChild(arr[i]);
	                    }
	                }
	            },

	            move2: function () {
	                var arr = $("tc").getElementsByTagName("img");
	                for (var i = 0; i < arr.length; i++) {
	                    var num2 = ((($("tc").offsetWidth) + (2 * arr[i].offsetWidth)) / 2000);
	                    if (num2 <= 1)
	                        num2 = 1;
	                    var num = arr[i].offsetLeft - num2;
	                    arr[i].style.left = num + "px";
	                    if (num < -arr[i].offsetWidth) {
	                        $("tc").removeChild(arr[i]);
	                    }
	                }
	            },

	            randomColor: function () {
	                var color = Math.ceil(Math.random() * 16777215).toString(16);
	                while (color.length < 6) {
	                    color = "0" + color;
	                }
	                return color;
	            }
	        }
	    });
	</script>
</html>
